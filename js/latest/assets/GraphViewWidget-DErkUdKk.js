var X=Object.defineProperty;var Z=(n,a,l)=>a in n?X(n,a,{enumerable:!0,configurable:!0,writable:!0,value:l}):n[a]=l;var s=(n,a,l)=>Z(n,typeof a!="symbol"?a+"":a,l);import{j as t,r as i}from"./index-CossuYGe.js";import{Q as _,f as $,g as J,O as ee,h as te,x as T,R as re,aM as z,a5 as oe,y as se}from"./storyArgs-D6apI4ht.js";import{D as B,N as ie,E as ae}from"./ts4nfdiGraphStyle-BNKMM8Km.js";import{E as ne}from"./popover-B_yoE_Z0.js";import{E as le}from"./button_empty-26YC--8U.js";function ce(n){var O;const{api:a,iri:l,ontologyId:f,rootWalk:h,className:P}=n,[k,E]=i.useState(l),[u,j]=i.useState(!0),[g,x]=i.useState(!1),[c,v]=i.useState(h||!1),[D,C]=i.useState(!1),[S,L]=i.useState(0),R=new ee(a),N=P||"ts4nfdi-graph-style",{data:y,isLoading:Y,isError:M,error:Q}=te(["termGraph",a,k,f,c,g,S],async()=>{if(c&&u)return R.getTermTree({ontologyId:f,termIri:l},{viewMode:"All",siblings:!1});if(u||g)return R.getTermRelations({ontologyId:f,termIri:k})}),p=i.useRef(new B([])),m=i.useRef(new B([])),b=i.useRef({}),I=i.useRef(null),A={autoResize:!0,height:"100%",width:"100%",locale:"en",layout:{randomSeed:1,improvedLayout:!0,clusterThreshold:150},physics:{enabled:!0,barnesHut:{gravitationalConstant:-2e4,centralGravity:.3,springLength:10,springConstant:.04,damping:.09,avoidOverlap:0}}};class F{constructor({node:e}){s(this,"id");s(this,"label");s(this,"color");s(this,"shape");s(this,"font");this.id=e.iri,this.label=e.label,this.color={background:"#455469",highlight:{border:"#404040",background:"#404040"}},this.shape="box",this.font={color:"white"}}}class V{constructor({edge:e}){s(this,"id");s(this,"from");s(this,"to");s(this,"label");s(this,"arrows");s(this,"width");s(this,"color");s(this,"font");s(this,"dashes");e.source&&e.target&&e.uri&&(this.id=e.source+e.target+"&uri="+e.uri,this.from=e.source,this.to=e.target,this.label=e.label,this.arrows={to:!0},this.width=2,this.color={color:"gray",highlight:"#00617C"},this.font={size:16})}}function q(o){let e={nodes:[],edges:[]};return o.map(r=>{if(!e.nodes.find(d=>d.iri===r.iri)){let d={iri:r.iri,label:r.text};e.nodes.push(d)}let w=o.find(d=>d.id===r.parent);if(w){let d={source:r.iri,target:w.iri,label:"subClassOf",uri:"http://www.w3.org/2000/01/rdf-schema#subClassOf"};e.edges.find(W=>W.source===d.source&&W.target===d.target)||e.edges.push(d)}}),e}if(y&&(u||g)){let o=y;c&&u&&(o=q(y));for(let e of o.nodes){let r=new F({node:e});p.current.get(r.id)||(r.id===l&&c&&(r.color.background="#0BBBEF",r.font.color="black"),p.current.add(r))}for(let e of o.edges){let r=new V({edge:e}),w=!(e.uri==="http://www.w3.org/2000/01/rdf-schema#subClassOf"||c);r.dashes=w,m.current.get(r.id)||((O=r.id)!=null&&O.includes(l)&&c&&(r.color.color="black"),m.current.add(r))}u&&j(!1),g&&x(!1)}function G(){p.current.clear(),m.current.clear(),E(l),j(!0),x(!1),L(S+1)}i.useEffect(()=>{let o={nodes:p.current,edges:m.current};b.current=new ie(I.current,o,A)},[]),i.useEffect(()=>{b.current&&b.current.on("doubleClick",function(o){if(o.nodes.length>0){let e=o.nodes[0];E(e),x(!0)}})},[b]),i.useEffect(()=>{G()},[c,a,f,l]),i.useEffect(()=>{v(h||!1)},[h]);const H=()=>C(o=>!o),K=()=>C(!1),U=t.jsx(le,{iconType:"iInCircle",iconSide:"right",onClick:H,children:"Guide me"});return t.jsxs("div",{className:N,children:[M&&t.jsx(T,{children:re(Q,"graph")}),t.jsxs(z,{style:{fontSize:12},paddingSize:"s",borderRadius:"none","data-testid":"graph-view",children:[t.jsx(oe,{size:"s",onClick:G,children:"Reset"}),t.jsx(ne,{button:U,isOpen:D,closePopover:K,children:t.jsxs(T,{style:{width:300,padding:10},children:[t.jsx("li",{children:"You can expand the nodes by double clicking on them"}),t.jsx("li",{children:"You can zoom out/in by scrolling on the graph."}),t.jsx("li",{children:"You can go back to the initial graph by clicking on the Reset button."}),t.jsx("li",{children:"You can move the nodes and edges around by dragging."}),t.jsx("li",{children:"Rootwalk toggle enable the root walk mode in the graph, where you can see the path from roots to the target node."})]})}),t.jsx("div",{style:{display:"inline-block",float:"right",paddingTop:10},children:t.jsx(ae,{label:"root walk",checked:c,onChange:()=>{v(!c)},title:"Enable the root walk mode in the graph: You can see the path from roots to the target node"})})]}),t.jsxs(z,{style:{width:900,height:900},hasShadow:!1,hasBorder:!0,borderRadius:"none",children:[Y&&t.jsx(se,{size:"m"}),t.jsx("div",{ref:I,className:"graph-container",style:{width:"850px",height:"850px",margin:"auto"}})]})]})}function me(n){const a=new _;return t.jsx($,{colorMode:"light",globalStyles:!1,children:t.jsx(J,{client:a,children:t.jsx(ce,{api:n.api,iri:n.iri,ontologyId:n.ontologyId,rootWalk:n.rootWalk})})})}export{ce as G,me as W};
